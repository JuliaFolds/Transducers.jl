name: pkg-update

on:
  schedule:
    - cron: '0 0 * * *'
  push:
    branches:
      - actions/trigger/pkg-update

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      # https://github.com/tkf/julia-merge-except-manifests
      - name: 'Merge master to create-pull-request/pkg-update'
        uses: tkf/julia-merge-except-manifests@v1
        with:
          target: create-pull-request/pkg-update

      # https://github.com/tkf/julia-update-manifests
      - name: Update */Manifest.toml
        uses: tkf/julia-update-manifests@v1
        with:
          version: '1.3'
          projects: test docs
      - name: Update test/environments/jl10/Manifest.toml
        uses: tkf/julia-update-manifests@v1
        with:
          version: '1.0'
          projects: test/environments/jl10

      # https://github.com/peter-evans/create-pull-request
      # https://github.com/marketplace/actions/create-pull-request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update */Manifest.toml
          title: '[AUTO] Update */Manifest.toml'
          labels: no changelog
          branch: create-pull-request/pkg-update
          branch-suffix: none
          base: master
      - name: Check output environment variable
        run: echo "Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}"
